{# core import #}
{% import 'scarfinity/template/components/navigation/breadcrumbs.twig' as _breadcrumbs %}

{# components import #}
{% import 'scarfinity/template/components/category-product-card.twig' as _categoryProductCard %}
{% import 'scarfinity/template/components/catalog/catalog-header.twig' as _catalogHeader %}

{{ header }}

{{ _breadcrumbs.Breadcrumbs({breadcrumbs: breadcrumbs}) }}

<div id="product-catalog" class="container">
  <div class="row s-content">
    
    {{ column_left }}

    <div id="content" class="s-content__middle">
    
      {{ content_top }}
      
      <h1>{{ heading_title }}</h1>  

      {% for category in categories %}
        <div class="catalog-subheader-delim">
          <h3><a href="{{ category.href }}">{{ category.name }}</a><span>({{ category.product_total }})</span></h3>
        </div>
        <div class="row product-card-catalog-row">
        {% for product in category.products %}
          <div class="product-card-catalog-container product-card-catalog-container--catalog">
            {{ _categoryProductCard.categoryProductCard(product, { 'buttonLabel': button_cart }) }}
          </div>
          {% endfor %}
        </div>
      {% endfor %}


{#       {% if thumb or description %}
      <div class="row"> {% if thumb %}
        <div class="col-sm-2"><img src="{{ thumb }}" alt="{{ heading_title }}" title="{{ heading_title }}" class="img-thumbnail" /></div>
        {% endif %}
        {% if description %}
        <div class="col-sm-10">{{ description }}</div>
        {% endif %}</div>
      <hr>
      {% endif %}
      {% if categories %}
      <h3>{{ text_refine }}</h3>
      {% if categories|length <= 5 %}
      <div class="row">
        <div class="col-sm-3">
          <ul>
            {% for category in categories %}
            <li><a href="{{ category.href }}">{{ category.name }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% else %}
      <div class="row">{% for category in categories|batch((categories|length / 4)|round(1, 'ceil')) %}
        <div class="col-sm-3">
          <ul>
            {% for child in category %}
            <li><a href="{{ child.href }}">{{ child.name }}</a></li>
            {% endfor %}
          </ul>
        </div>
        {% endfor %}</div>
      <br />
      {% endif %}
      {% endif %} #}
      {% if products %}
      <div class="row">
        <div class="col-md-2 col-sm-6 hidden-xs">
          <div class="btn-group btn-group-sm" style="display: none;">
            <button type="button" id="list-view" class="btn btn-default" data-toggle="tooltip" title="{{ button_list }}"><i class="fa fa-th-list"></i></button>
            <button type="button" id="grid-view" class="btn btn-default" data-toggle="tooltip" title="{{ button_grid }}"><i class="fa fa-th"></i></button>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          {# <div class="form-group"><a href="{{ compare }}" id="compare-total" class="btn btn-link">{{ text_compare }}</a></div> #}
        </div>
        
        <div class="col-md-12 col-xs-12">
          {{
            _catalogHeader.CatalogHeader({ 
              sort: {
                id: "input-sort",
                title: text_sort,
                options: sorts,
                selectedValue: '%s-%s'|format(sort, order)
              },
              valueSwitch: {
                name: "input-limit",
                title: text_limit,
                values: limits,
                selectedValue: limit
              }
            })
          }}
        </div>

      </div>

      <div class="row product-card-catalog-row">
        {% include 'scarfinity/template/product/products.twig' ignore missing %}
      </div>

      {% endif %}

      {% if not categories and not products %}
      <p>{{ text_empty }}</p>
      <div class="buttons">
        <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>
      </div>
      {% endif %}
      {{ content_bottom }}</div>
    {{ column_right }}</div>
</div>

{# <script type="text/javascript">
  function fetch(nextHref) {
    if(nextHref) {
      $.ajax({
        url: nextHref,
        dataType: 'html',
        beforeSend: function() {
          $('#fetch').attr("disabled", "disabled");
        },
        success: function(html) {
          $('#competitor').before(html).remove();
          catalogProductCardController.__init();
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
      });
    }

    return false;
  }
</script> #}

{{ footer }} 
